<nav class="main-navbar">
    <div class="navbar-container">
        <!-- BẮT ĐẦU SỬA ĐỔI: Bọc logo/brand vào một container để định vị dropdown -->
        <div class="navbar-brand-container">
            {# THAY ĐỔI: Đánh dấu 'active' cho brand khi ở trang chủ giới thiệu (/home) #}
            <a href="{{ url_for('main.home') }}" class="navbar-brand {% if request.endpoint == 'main.home' %}active{% endif %}" id="brand-logo-link"> {# Đổi ID để rõ ràng hơn #}
                <i class="fas fa-brain"></i>
                <span class="brand-text">MindStack</span> {# THÊM class để ẩn/hiện #}
                {# XÓA mũi tên này vì không còn là dropdown #}
            </a>
        </div>
        <!-- KẾT THÚC SỬA ĐỔI -->

        {# BẮT ĐẦU THAY ĐỔI: Hiển thị các tab điều hướng chỉ khi người dùng đã đăng nhập #}
        {% if session.get('username') %}
            <ul class="navbar-nav">
                <li>
                    {# THAY ĐỔI: Chỉ active khi endpoint thực sự thuộc flashcard, không phải main.home #}
                    <a href="{{ url_for('flashcard.index') }}" class="nav-link {% if request.endpoint.startswith('flashcard.') %}active{% endif %}">
                        <i class="fas fa-layer-group"></i> <span class="nav-link-text">Flashcard</span> {# THÊM class để ẩn/hiện #}
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('quiz.index') }}" class="nav-link {% if request.endpoint.startswith('quiz.') %}active{% endif %}">
                        <i class="fas fa-question-circle"></i> <span class="nav-link-text">Trắc nghiệm</span> {# THÊM class để ẩn/hiện #}
                    </a>
                </li>
                <li>
                    {# BẮT ĐẦU THAY ĐỔI: Cập nhật link Dashboard #}
                    <a href="{{ url_for('main.dashboard') }}" class="nav-link {% if request.endpoint == 'main.dashboard' %}active{% endif %}">
                        <i class="fas fa-chart-line"></i> <span class="nav-link-text">Thống kê</span> {# THÊM class để ẩn/hiện #}
                    </a>
                </li>
            </ul>
        {% endif %}
        {# KẾT THÚC THAY ĐỔI #}

        <!-- Phần bên phải: Menu người dùng (giữ nguyên) -->
        <div class="navbar-user-menu">
            {% if session.get('username') %}
                <div class="user-menu-trigger" id="user-menu-trigger">
                    <span class="username-text">{{ session.get('username') }}</span> {# THÊM class để ẩn/hiện #}
                    <i class="fas fa-user-circle user-icon"></i> {# THÊM icon và class #}
                    <i class="fas fa-chevron-down user-chevron"></i> {# THÊM class để dễ điều khiển #}
                </div>
                <div class="user-dropdown-menu" id="user-dropdown-menu">
                    {% if session.get('user_role') == 'admin' %}
                        <a href="{{ url_for('admin.dashboard') }}" class="dropdown-item">
                            <i class="fas fa-user-shield"></i> Admin Panel
                        </a>
                    {% endif %}
                    <a href="#" class="dropdown-item">
                        <i class="fas fa-cog"></i> Cài đặt
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="{{ url_for('auth.logout') }}" class="dropdown-item">
                        <i class="fas fa-sign-out-alt"></i> Đăng xuất
                    </a>
                </div>
            {% else %}
                {# BẮT ĐẦU THAY ĐỔI: Chỉ hiển thị nút đăng nhập nếu không phải trang đăng nhập #}
                {% if request.endpoint != 'auth.login' %}
                <a href="{{ url_for('auth.login') }}" class="nav-link">Đăng nhập</a>
                {% endif %}
                {# KẾT THÚC THAY ĐỔI #}
            {% endif %}
        </div>
    </div>
</nav>
